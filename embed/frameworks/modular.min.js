/**
 * Modular.js 1.0
 * 2013 - Clemens Damke
 * License: WTFPL - Have fun! Credits only if you want to.
 */

var Modular=(function(e){var d=function(f,h,i){var g=this;window[f]=this;g.init=i;d.loadModules(h,function(j){Object.getPrototypeOf(g).run.call(g,j)},f)};d.loaded={};d.modules={};d.path="";d.requiredBy={};d.isOk=function(f){return f%2==1};d.status=function(f){return this.status.codes[f]};d.status.codes={1:"Module already loaded",2:"Module could not be loaded",3:"Module loaded",4:"Module loaded but invalidly defined",5:"Circular requirement loop had to be interrupted at first link-back (may cause problems in one modules 'init()')"};d.setModulePath=function(f){if(f!==undefined){this.path=f}return this};d.setModules=function(f){if(f!==undefined){this.modules=f}return this};d.addModules=function(f){this.modules=e.extend(this.modules,f);return this};var a=function(h,f){for(var g=0;g<h.length;g++){h[g].apply(d,f)}},c=function(f,g){if(!d.requiredBy[f]){d.requiredBy[f]={}}d.requiredBy[f][g]=true},b=function(h,i,f){if(!f){f={}}f[h]=true;if(d.requiredBy[h]){if(d.requiredBy[h][i]){return true}for(var g in d.requiredBy[h]){if(!f[g]&&b(g,i,f)){return true}}}return false};d.loadModule=function(i,j,g){var h=this;if(g){c(i,g)}if(!h.loaded[i]){h.loaded[i]=typeof j==="function"?[j]:[];if(!h.modules[i]){h.modules[i]=i+".js"}var f=function(k,l){a(h.loaded[i],[k,i]);h.loaded[i]=l};e.getScript(h.path+h.modules[i],function(){if(window[i]){h.prototype.onDone.call(window[i],function(){f(3,true)})}else{f(4,true)}}).fail(function(m,l,k){if(m.status==200&&k){f(4,true);throw new Error("In '"+i+"': "+k.message)}else{f(2,false)}})}else{if(j){if(h.loaded[i]===true||(g&&window[i]&&b(g,i))){setTimeout(function(){j(h.loaded[i]===true?1:5,i)},0)}else{h.loaded[i].push(j)}}}return h};d.loadModules=function(j,l,h){var g=0,f={};if(j&&j.length){for(var k=0;k<j.length;k++){this.loadModule(j[k],function(i,m){g++;f[m]=i;if(g>=j.length&&l){l(f)}},h)}}else{if(l){setTimeout(function(){l(f)},0)}}return this};d.prototype={run:function(f){if(this.init){this.init(f)}if(this.doneCallback){this.doneCallback()}if(!this.hasOwnProperty("run")){this.run=null}},onDone:function(f){this.doneCallback=f}};return d})(jQuery);